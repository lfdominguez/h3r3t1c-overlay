---
name: "Build"

on:
  push:
    branches:
      - master
  pull_request: {}
  workflow_dispatch: {}

  jobs:
    build:
      runs-on: ${{ matrix.os }}
      strategy:
        matrix:
          os: [ubuntu-latest]
        steps:
          - uses: actions/checkout@v3
          - uses: cachix/install-nix-action@v16
            with:
              extra_nix_config: |
                access-tokens = github.com=${{ secrets.GITHUB_TOKEN }}
          - uses: cachix/cachix_action@v10
            with:
              name: lfdominguez
              authToken: '${{ secrets.CACHIX_TOKEN }}'
          - run: nix flake show --json | jq '.packages."x86_64-linux"|keys[]'| xargs -I {} nix build .#{}
